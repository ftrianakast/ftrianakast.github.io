---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { t, getLangFromUrl } from '../../i18n';
import { getCollection } from 'astro:content';

const currentLang = getLangFromUrl(Astro.url);

// Get all blog posts for current language
const allPosts = await getCollection('blog', ({ data }) => {
  return data.lang === currentLang;
});

// Sort posts by date (newest first)
const posts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title={t(currentLang, 'blog.title')}>
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
    <h1 class="text-4xl md:text-5xl font-macondo mb-4" style="color: var(--color-ink);">{t(currentLang, 'blog.heading')}</h1>
    <p class="text-xl mb-16" style="color: var(--color-ink-light);">{t(currentLang, 'blog.subtitle')}</p>

    <div class="ornamental-divider mb-12"></div>

    {posts.length === 0 ? (
      <div class="text-center py-12">
        <p class="text-lg" style="color: var(--color-ink-light);">{t(currentLang, 'blog.noPosts')}</p>
      </div>
    ) : (
      <div class="space-y-12">
        {posts.map((post) => {
          const baseSlug = post.slug.replace(/^(es|en|de)\//, '');
          return (
            <article class="pb-8 border-b" style="border-color: var(--color-gold);">
              <time class="text-sm font-macondo" style="color: var(--color-ink-light);" datetime={post.data.pubDate.toISOString()}>
                {post.data.pubDate.toLocaleDateString(currentLang, {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
                })}
              </time>
              <h2 class="text-3xl font-macondo mt-2 mb-3">
                <a href={`/de/blog/${baseSlug}`} class="hover:text-[--color-gold] transition-colors" style="color: var(--color-ink);">
                  {post.data.title}
                </a>
              </h2>
              <p class="text-lg leading-relaxed" style="color: var(--color-ink-light);">{post.data.description}</p>
            </article>
          );
        })}
      </div>
    )}
  </div>
</BaseLayout>
